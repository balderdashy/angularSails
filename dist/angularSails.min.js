/*
  angularSails 0.0.0-build1394825224246
  Built with <3 by Balderdashy

  Core Contributors: 
   -Rob Wormald <rob.wormald@innitapps.com>
   -Gabe Hernandez <ghernandez345@gmail.com>
   -Andrew Rhyne <rhyneandrew@gmail.com>
*/
!function(){"use strict";var a=angular.module("angularSails.base",["angularSails.io"]);a.factory("angularSailsSocket",["sailsSocketFactory",function(a){return a()}]),a.factory("$sails",["$q","angularSailsSocket",function(a,b){var c=function(a,b,c,d){this.q=a,this.sailsSocket=b,this.url=c,this.query=d};return c.prototype={construct:function(){var a=this,b={};return b.$add=function(b){a.sailsSocket.post(a.url,b).then(function(b){a._updateModel(b.id,b,"created")})},b.$update=function(b){angular.isUndefined(b);var c=a._getModel(b);a.sailsSocket.put(a.url+"/"+c.id,c).then(function(b){a._updateModel(b.id,b,"updated")})},b.$remove=function(b){angular.isUndefined(b);var c=a._getModel(b);c?a.sailsSocket.delete(a.url,c).then(function(b){a._updateModel(b.id,b,"destroyed")}):a.sailsSocket.delete(a.url)},b.$save=function(b){angular.isUndefined(b)&&a.sailsSocket.put(a.url,this)},a._object=b,a._getInitalData(),b},_getInitalData:function(){var a=this,b=a.sailsSocket.get(a.url,a.query);b.then(function(b){angular.forEach(b,function(b){a._updateModel(b.id,b,"read")}),a._setUpListeners()})},_getModel:function(a){var b,c={};if(angular.isObject(a))b=a.id;else if(angular.isString(a))b=parseInt(a,10);else{if(!angular.isNumber(a))return c;b=a}return c=this._object[b]},_updateModel:function(a,b,c){"destroyed"!==c?this._object[a]=b:delete this._object[a]},_setUpListeners:function(){var a=this,b=a.url.slice(1);a.sailsSocket.on(b,function(b){var c=b.verb,d=b.data||b.previous;a._updateModel(d.id,d,c)})}},function(d,e){var f=new c(a,b,d,e);return f.construct()}}])}(),function(a){"use strict";var b=angular.module("angularSails.io",[]);b.provider("sailsSocketFactory",function(){var b="sails:";this.$get=["$q","$rootScope","$timeout","$window",function(c,d,e,f){var g=function(a,b){return b?function(){var c=arguments;e(function(){b.apply(a,c)},0)}:angular.noop},h=function(b,d,e,f){var h=c.defer();e=e.replace(/^(.+)\/*\s*$/,"$1"),d=d||"get","string"!=typeof e&&h.reject(new Error("Invalid or missing URL!\n"));var i=a.JSON.stringify({url:e,data:f});return b.emit(d,i,g(b,function(b){var c=b;if(b&&"string"==typeof b)try{c=a.JSON.parse(b)}catch(d){return"undefined"!=typeof console&&console.warn("Could not parse:",b,d),h.reject("Server response could not be parsed!\n"+b)}switch(c.status){case 404:return h.reject(new Error("404: Not found"));case 403:return h.reject(new Error("403: Forbidden"));case 500:return h.reject(new Error("500: Server Error"));default:return h.resolve(c)}})),h.promise};return function(c){c=c||{};var e=f.location.origin||"http://localhost:1337";if(c.token){var i="?token="+c.token;e+=i}var j=c.ioSocket||a.connect(e),k=c.prefix||b,l=c.scope||d,m=function(a,b){j.on(a,g(j,b))},n={on:m,addListener:m,emit:function(a,b,c){return j.emit(a,b,g(j,c))},removeListener:function(){return j.removeListener.apply(j,arguments)},forward:function(a,b){a instanceof Array==!1&&(a=[a]),b||(b=l),a.forEach(function(a){var c=k+a,d=g(j,function(a){b.$broadcast(c,a)});b.$on("$destroy",function(){j.removeListener(a,d)}),j.on(a,d)})},get:function(a,b){return h(j,"get",a,b)},post:function(a,b){return h(j,"post",a,b)},put:function(a,b){return h(j,"put",a,b)},"delete":function(a,b){return h(j,"delete",a,b)}};return n}}]}),b.config(["$provide",function(a){a.decorator("$q",function(a){var b=a.defer;return a.defer=function(){var a=b();return a.promise.success=function(b){return a.promise.then(function(a){b(a)}),a.promise},a.promise.error=function(b){return a.promise.then(null,function(a){b(a)}),a.promise},a},a})}])}(window.io||{JSON:window.JSON,connect:angular.noop}),function(a){"use strict";angular.module("angularSails.stream",[]).factory("$sailsStream",["$q","$rootScope",function(b,c){return{publish:function(d,e){if(!c.$$listeners[d])return[];for(var f=[],g=0;g<c.$$listeners[d].length;g++)f.push(b.defer());var h={args:e,reject:function(a){f.pop().reject(a)},resolve:function(a){f.pop().resolve(a)}};c.$broadcast(d,h);var i=a.map(f,function(a){return a.promise});return i},subscribe:function(a,b){return c.$on(a,b)},unsubscribe:function(a){angular.isFunction(a)&&a()}}}])}(window._);
//# sourceMappingURL=angularSails.min.map